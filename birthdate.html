<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¼ Venuss Chattra ğŸŒ¼ - Birthdays</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>ğŸŒ¼ Venuss Chattra ğŸŒ¼</h1>
    <p>ğŸ‚ Dorm Birthdates ğŸ‚</p>
  </header>

  <header>ğŸ¤™Famsss til' GraddsssğŸ¤™</header>

  <img src="images/dormfamily.png" class="main-image" alt="Dorm Family">

  <div class="container card">
    <h2>ğŸ“… Dorm Birthdates</h2>
    <ul id="event-list">
    </ul>

  
    <div id="admin-controls" style="display: none">
      <h3>Admin Controls</h3>
      <input type="text" id="name-input" placeholder="Name (example: Venus)">
      <input type="date" id="date-input">
      <button onclick="addBirthday()">Add</button>
    </div>

    <div class="page-navigation" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
        
        <!-- Tombol Khusus Admin -->
        <div class="admin-only-buttons" style="margin-bottom: 20px;">
            <button id="delete-all-btn" onclick="deleteAll()" style="display: none;">ğŸ—‘ï¸ Delete All Birthdays</button>
        </div>

        <!-- Tombol Navigasi Utama -->
        <div class="main-navigation" style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;">
            <a href="picket.html"><button>ğŸ§¹ Picket Schedule</button></a>
            <a href="korve.html"><button>ğŸª£ Korve Schedule</button></a>
            <a href="curhatpadlet.html"><button>ğŸ’Œ Curhat Padlet</button></a>
        </div>
    </div>

  </div>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
  
  const supabaseUrl = "https://uhxzvovlzgjmicermdjj.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoeHp2b3ZsemdqbWljZXJtZGpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MDczMTksImV4cCI6MjA3OTA4MzMxOX0.rMPLBcB2_Hq6p-IWGl-teKwcK6-6-VQMN-XIErHQYR4";

  
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);


  let userRole = null;

  
  document.addEventListener('DOMContentLoaded', () => {
  
    const isLoggedIn = localStorage.getItem("loggedIn");
    if (isLoggedIn !== "true") {
      alert("You need to log in first!");
      window.location.href = "login.html";
      return;
    }

    userRole = localStorage.getItem("role");

    if (userRole === "admin") {
      document.getElementById("admin-controls").style.display = "block";
      document.getElementById("delete-all-btn").style.display = "inline-block";
    }

    loadBirthdays();
  });

  
  async function loadBirthdays() {
    const ul = document.getElementById("event-list");
    ul.innerHTML = "<li>Loading birthdays...</li>"; 

    const { data, error } = await supabaseClient
      .from("birthday")
      .select("*")
      .order("date", { ascending: true });

    if (error) {
      console.error("Error loading birthdays:", error.message);
      ul.innerHTML = "<li>Could not load data. Check console for errors.</li>";
      return;
    }

    ul.innerHTML = ""; 

    if (data.length === 0) {
      ul.innerHTML = "<li>No birthdays have been added yet.</li>";
    } else {
      data.forEach(row => {
        const li = document.createElement("li");
        const formattedDate = new Date(row.date).toLocaleDateString('en-GB', { day: '2-digit', month: 'long' });
        li.textContent = `${row.name} â€” ${formattedDate}`;

        if (userRole === "admin") {
          const delButton = document.createElement("button");
          delButton.textContent = "âŒ";
          delButton.style.marginLeft = "10px";
          delButton.onclick = () => deleteBirthday(row.id);
          li.appendChild(delButton);
        }
        ul.appendChild(li);
      });
    }
  }

  async function addBirthday() {
    const name = document.getElementById("name-input").value.trim();
    const date = document.getElementById("date-input").value.trim();

    if (!name || !date) {
      alert("Please fill in both name and date!");
      return;
    }

    const { error } = await supabaseClient.from("birthday").insert([{ name, date }]);

    if (error) {
      alert("Failed to add birthday: " + error.message);
    } else {
      document.getElementById("name-input").value = "";
      document.getElementById("date-input").value = "";
      loadBirthdays();
    }
  }

async function deleteBirthday(id) {
    alert("Mencoba menghapus data dengan ID: " + id);

    if (!confirm("Are you sure you want to delete this birthday?")) return;

    const { error } = await supabaseClient
      .from("birthday")
      .delete()
      .eq("id", id);

    if (error) {
      alert("Failed to delete birthday: " + error.message);
      console.error("Delete error:", error);
    } else {
      loadBirthdays(); 
    }
}

  async function deleteAll() {
    if (!confirm("DANGER! This will delete ALL birthdays. Are you sure?")) return;

    const { error } = await supabaseClient.from("birthday").delete().neq("id", -1);

    if (error) {
      alert("Failed to delete all birthdays: " + error.message);
    } else {
      loadBirthdays(); 
    }
  }
</script>

</body>
</html>

